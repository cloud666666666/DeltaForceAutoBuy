# 三角洲行动自动购买助手 🚀

一个专为《三角洲行动》游戏设计的智能门卡自动购买工具，支持价格监控、定时购买和OCR识别。

## ⚠️ 重要提醒 - 路径要求

**🔥 必读：程序路径不能包含中文字符！**

❌ **错误示例：**
```
C:\用户\张三\桌面\三角洲工具\DeltaForceKeyBot-1\
D:\我的游戏工具\Delta工具\
C:\Users\小明\Documents\游戏助手\
```

✅ **正确示例：**
```
C:\Users\zhangsan\Desktop\DeltaForceKeyBot-1\
D:\Games\DeltaForceKeyBot-1\
C:\Tools\DeltaBot\
```

**为什么有这个要求？**
- OCR识别组件(Tesseract)对中文路径支持不好
- 可能导致"找不到路径"或"程序无法启动"的错误
- 这是技术限制，不是程序bug

## 🎯 主要功能

- 🔍 **智能价格识别**：使用OCR技术自动识别门卡价格
- 💰 **价格监控**：只在价格低于设定值时购买
- ⏰ **定时购买**：支持设定具体时间自动购买
- 🎮 **热键控制**：F8开始、F9停止、Ctrl+Shift+Q紧急退出
- 📊 **数量控制**：可设置购买数量避免重复购买
- 🖥️ **窗口识别**：自动识别游戏窗口，支持窗口模式和全屏模式

## 📋 系统要求

- **操作系统**：Windows 10/11
- **Python版本**：3.8+ (使用虚拟环境无需单独安装)
- **游戏**：三角洲行动 (Delta Force)
- **权限**：管理员权限 (用于键盘热键功能)

## 🚀 快速开始

### 方法一：使用预配置启动脚本 (推荐新手)

1. **下载解压**
   ```
   解压到英文路径，例如：C:\DeltaForceKeyBot-1\
   ```

2. **双击启动**
   ```
   双击 "启动.bat" 文件
   ```
   - 程序会自动请求管理员权限
   - 自动激活虚拟环境并启动程序

3. **首次配置**
   - 程序启动后会显示当前配置
   - 根据提示设置价格阈值、购买数量、定时时间

### 方法二：手动安装配置

1. **安装Python** (如果没有虚拟环境)
   ```bash
   # 下载并安装Python 3.8+
   # 创建虚拟环境
   python -m venv .venv
   
   # 激活虚拟环境
   .venv\Scripts\activate
   
   # 安装依赖
   pip install -r requirements.txt
   ```

2. **运行程序**
   ```bash
   python main.py
   ```

## 📁 文件结构

```
DeltaForceKeyBot-1/
├── 启动.bat              # 一键启动脚本(推荐)
├── main.py               # 主程序文件
├── keys.json             # 配置文件
├── requirements.txt      # Python依赖包
├── README.md            # 使用说明
├── .venv/               # Python虚拟环境
└── Tesseract/           # OCR识别引擎
    ├── tesseract.exe    # OCR主程序
    ├── tessdata/        # 语言包
    └── ...              # 其他依赖文件
```

## ⚙️ 配置说明

### keys.json 配置文件
```json
{
    "keys": [
        {
            "max_price": 99999999,     // 最高购买价格
            "position": [0.3517, 0.2678],  // 门卡点击位置(屏幕百分比)
            "detail_price_region": {    // 价格识别区域
                "top_left": [0.7795, 0.8211],
                "bottom_right": [0.8862, 0.882]
            },
            "buyAmount": 3,            // 购买数量
            "scheduledTime": "17:49"   // 定时购买时间(24小时制)
        }
    ]
}
```

### 配置参数说明

| 参数 | 说明 | 示例 |
|------|------|------|
| `max_price` | 最高购买价格，超过此价格不购买 | `50000` |
| `position` | 门卡在屏幕上的点击位置(百分比) | `[0.35, 0.27]` |
| `detail_price_region` | 价格文字的识别区域 | 见上方示例 |
| `buyAmount` | 每次购买的数量 | `3` |
| `scheduledTime` | 定时购买时间，格式HH:MM | `"17:49"` |

## 🎮 操作指南

### 游戏配置要求

**重要：程序运行前请先按以下步骤配置游戏！**

1. **启动三角洲行动游戏**
2. **进入游戏设置**：主菜单 → 设置 → 视频
3. **按图示配置**：
   ```
   显示模式：窗口
   分辨率：1920x1080
   显示区域纵横比：16:9
   ```
4. **应用并重启游戏**

**为什么需要这样配置？**
- 窗口模式：程序能更准确地识别游戏窗口位置
- 1920x1080分辨率：程序的坐标系统基于此分辨率优化
- 16:9比例：确保界面元素位置准确

**⚠️ 注意事项：**
- 不要使用全屏模式，会影响坐标识别
- 不要在程序运行时调整游戏窗口大小
- 确保游戏窗口没有被其他程序遮挡

### 启动流程
1. **配置游戏窗口**：
   - 打开三角洲行动游戏
   - 进入设置 → 视频设置
   - **推荐配置**：
     - 显示模式：**窗口** (不要选择全屏)
     - 分辨率：**1920x1080** 
     - 显示区域纵横比：**16:9**
   - 应用设置并重启游戏

2. **运行程序**：双击 `启动.bat` 或运行 `main.py`
3. **配置设置**：首次运行会提示配置参数
4. **开始监控**：按F8开始或等待定时启动

### 热键说明
- **F8**：手动开始购买流程
- **F9**：停止程序
- **Ctrl+Shift+Q**：紧急退出

### 使用步骤
1. 在游戏中打开门卡购买界面
2. 启动程序，按F8开始监控
3. 程序会自动：
   - 识别当前价格
   - 与设定价格比较
   - 价格合适时自动购买
   - 购买达到设定数量后停止

## 🔧 常见问题

### Q1: 程序提示"未找到Tesseract"
**A:** 检查路径问题
- 确保程序路径不包含中文字符
- 确保Tesseract文件夹在程序目录中
- 重新解压到英文路径

### Q2: 热键不工作 (F8/F9无反应)
**A:** 权限问题
- 右键"启动.bat" → 以管理员身份运行
- 或者直接双击启动.bat，程序会自动请求权限

### Q3: 价格识别不准确
**A:** 配置问题
- **检查游戏分辨率**：必须设置为1920x1080窗口模式
- **检查显示缩放**：Windows显示缩放应设置为100%
- 调整`detail_price_region`坐标
- 确保游戏界面清晰可见，价格数字完整显示

### Q4: 程序启动后立即退出
**A:** 检查以下问题
- 虚拟环境是否完整 (.venv文件夹)
- 是否在正确的英文路径下
- 查看错误信息并检查配置文件

### Q5: 程序点击位置不准确
**A:** 分辨率和缩放问题
- **确认游戏分辨率**：必须设置为1920x1080窗口模式
- **检查Windows显示缩放**：右键桌面→显示设置→缩放设置为100%
- **重新获取坐标**：如果分辨率改变了，需要重新设置点击坐标
- **避免移动窗口**：程序运行时不要移动游戏窗口

### Q6: 买到不想要的物品
**A:** 安全设置
- 降低`max_price`设置
- 减少`buyAmount`数量
- 使用定时购买而非手动触发

## 📝 注意事项

### 使用安全
- ⚠️ 请合理设置购买价格，避免高价误购
- ⚠️ 建议先用小数量测试功能
- ⚠️ 程序运行时不要移动游戏窗口
- ⚠️ 确保游戏界面清晰，避免被其他窗口遮挡

### 路径要求
- 🔥 **程序路径必须是纯英文，不能包含中文字符**
- 🔥 **推荐路径：C:\DeltaForceKeyBot-1\ 或 D:\Games\DeltaBot\**
- 🔥 **避免放在桌面或含中文的文件夹中**

### 权限要求
- 需要管理员权限才能使用热键功能
- 启动.bat会自动请求权限
- 如果拒绝权限，只能使用定时功能

## 🛠️ 技术说明

### 依赖组件
- **pytesseract**: OCR文字识别
- **opencv-python**: 图像处理
- **pyautogui**: 屏幕操作
- **keyboard**: 键盘监听
- **pywin32**: Windows API

### 工作原理
1. 窗口检测：自动识别游戏窗口
2. 截图分析：截取价格区域
3. OCR识别：提取价格数字
4. 价格比较：与设定值比较
5. 自动操作：符合条件时自动点击购买

## 📞 技术支持

如果遇到问题：
1. 检查是否按照路径要求放置文件
2. 确认是否以管理员权限运行
3. 检查游戏是否正常运行
4. 查看控制台输出的错误信息

---

**祝您游戏愉快！** 🎮

> 提示：首次使用建议先阅读完整说明文档，特别注意路径要求部分。 